---
output: github_document
---

```{r, message=FALSE}
library(tidyverse)
library(httr)
library(jsonlite)
#  Report year
year <-  2022
```


```{r, warning= FALSE}
#
# Grab KPI from SCB API
#
query <-
"{
    \"query\": [],
    \"response\": {
        \"format\": \"json\"
    }
}"
KPI_url <- "https://api.scb.se/OV0104/v1/doris/sv/ssd/START/PR/PR0101/PR0101A/KPIFastM2"
response <- POST(url = KPI_url, body = query)
json <- content(response, "text")
KPI_data <- fromJSON(json)$data %>% 
    separate(key, into = c("Year", "Month"), sep = "M") %>% 
    rename(KPI = values) %>% 
    mutate(KPI = as.numeric(unlist(KPI)))

#
# Plot KPI
#
filter(KPI_data, Year == year) %>% 
    ggplot(aes(x = as.numeric(Month), y = KPI)) + 
    geom_point() + geom_line() +
    scale_x_continuous(name = "Month", breaks = 1:12) +
    ggtitle(paste("Consumer price index ", year)) +
    theme_minimal()
```

